<!DOCTYPE html>
<html lang="en">
    <head>
        <meta char set="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Leaflet Polygon Labels</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <style>
            #map {
                height: 600px;
                width: 100%;
            }
            /*.polygon-tooltip {
                color: black;
                background-color: rgb(232, 232, 30);
                opacity: 1.0;
                font-weight: regular;
                padding: 0px;
            }
            .polygon-tooltip-a {
                color: black;
                background-color: rgb(90, 241, 90);
                font-weight: regular;
                padding: 1px;
            }
            .polygon-tooltip-b {
                color: black;
                background-color: orange;
                font-weight: regular;
                padding: 1px;
            }*/
        </style>
    </head>
    <body>
        <a style="margin: 10px"; href="javascript:loadLayers('Floor-1','BayColonyGolfClub/bcgc-py-1','BayColonyGolfClub/bcgc-pt-1')">Floor-1</a>
        <a style="margin: 10px"; href="javascript:loadLayers('Floor-2','BayColonyGolfClub/bcgc-py-2','BayColonyGolfClub/bcgc-pt-2')">Floor-2</a>
        <p id="addr" style="text-align: center">Address</p>
        <p id="floor" style="text-align: center">Floor-1</p>
        <div id="map"></div>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script>
            var map = L.map('map').setView([26.26390170677747, -81.79506016462454], 19,
                { maxZoom: 22}
            );

            
            // Add OpenStreetMap tiles
            var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy: OpenStreetMap contributors',
                maxZoom: 22,
            });
            osm.addTo(map);

            // L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            //     maxZoom: 20,
            //     subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            // }).addTo(map);

            // polygons
            var pLayer = null;
            var pStyle = null;
            var addr = null;
            function removeAllLayers(){ 
                map.eachLayer(function (layer) {
                    map.removeLayer(layer);
                });
                map.addLayer(osm);
            }

            loadLayers('Floor-1','BayColonyGolfClub/bcgc-py-1','BayColonyGolfClub/bcgc-pt-1');
            
            async function loadLayers(floor, py, pt) {
                document.getElementById('floor').innerHTML = floor;
                const respy = await fetch(`https://raw.githubusercontent.com/bhdninh/911locate/refs/heads/main/${py}.geojson`);
                const poly = await respy.json();
                removeAllLayers();
                L.geoJson(poly, {
                        onEachFeature: function(feature, layer) {
                          if (addr == null) {
                            addr = `${feature.properties.street_address}, ${feature.properties.postal_community}, zip: ${feature.properties.zip}`;
                            document.getElementById('addr').innerHTML = addr;
                          }
                          if (pLayer == null) {
                            pLayer = layer;
                            pStyle = pLayer.options;
                          }
                          layer.bindPopup(`<p>${feature.properties.space_type}: ${feature.properties.room_label}<br>
                            Floor: ${feature.properties.floor_label}<br>
                            Height: ${feature.properties.floor_height}</p>`);
                          layer.on('click', function(e) {
                            e.target.setStyle({fillColor: 'red'});
                            pLayer.setStyle(pStyle);
                            pLayer = layer;
                          }).openTooltip();
                        }
                    }).addTo(map);
                // return textData;       // You can return it or use it elsewhere
            // }

            // async function loadPoint() {
                const respt = await fetch(`https://raw.githubusercontent.com/bhdninh/911locate/refs/heads/main/${pt}.geojson`);
                const point = await respt.json();

                L.geoJson(point, {
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`<p>${feature.properties.location_type}</p>`);
                        layer.on('click', function(e) {
                            pLayer.setStyle(pStyle);
                        });
                    }
                }).addTo(map);
            }

</script>
    </body>
</html>
